
module T = Otfed.Decode.ForTest


let assert_ok msg = function
  | Ok(_)    -> ()
  | Error(_) -> failwith msg


let string_of_uint16_list ns =
  let buf = Buffer.create (List.length ns * 2 + 2) in
  ns |> List.iter (fun n ->
    let c1 = Char.chr (n lsr 8) in
    let c2 = Char.chr (n land 255) in
    Buffer.add_char buf c1;
    Buffer.add_char buf c2);
  Buffer.contents buf


let glyph_data =
  string_of_uint16_list [
    (* `ipaexm.ttf`, glyph ID 1000 (offset: 520500, length: 608) *)
    0x0006; 0x0033; 0xff6d; 0x07ab; 0x0694; 0x001f; 0x0023; 0x0055;
    0x0059; 0x005d; 0x0061; 0x0125; 0x40ff; 0x1a16; 0x1402; 0x3a14;
    0x2f02; 0x3c2f; 0x3d02; 0x4124; 0x1e02; 0x043d; 0x0003; 0x0720;
    0x3f02; 0x433f; 0x4402; 0x4827; 0x260e; 0x0444; 0x4603; 0x4a11;
    0x1003; 0x464b; 0x034f; 0x210a; 0x0251; 0x4d52; 0x0236; 0x322d;
    0x2918; 0x050d; 0x1655; 0x540d; 0x0c09; 0x0806; 0x0d52; 0x3938;
    0x302f; 0x0359; 0x563e; 0x3d03; 0x5857; 0x403f; 0x035d; 0x5a45;
    0x4403; 0x5c5b; 0x4746; 0x0361; 0x5e4c; 0x4b03; 0x605f; 0x4e4d;
    0x0353; 0x5201; 0x1716; 0x011c; 0x1b15; 0x1403; 0x0100; 0x0123;
    0x2001; 0x2221; 0x010b; 0x0a01; 0x0e00; 0x0e38; 0x3002; 0x3e58;
    0x032b; 0x2f2d; 0x2b29; 0x0458; 0x5303; 0x0427; 0x261b; 0x1a04;
    0x0524; 0x0703; 0x1817; 0x0203; 0x0709; 0x031c; 0x0100; 0x0309;
    0x0b03; 0x1e14; 0x020b; 0x0d03; 0x5251; 0x4f4e; 0x4b4a; 0x4847;
    0x4443; 0x4140; 0x3d3c; 0x3a39; 0x3632; 0x120d; 0x343e; 0x1615;
    0x1110; 0x040d; 0x0d61; 0x605d; 0x5c59; 0x581e; 0x053e; 0x5f5e;
    0x5b5a; 0x5756; 0x5453; 0x1e07; 0x2408; 0x071e; 0x0109; 0x2120;
    0x0c0b; 0x1e03; 0x0d04; 0x044d; 0x4c46; 0x453f; 0x3e05; 0x5524;
    0x0123; 0x220a; 0x0903; 0x0e0d; 0x01b1; 0x0400; 0x2a2a; 0x102a;
    0x10c4; 0x2a2b; 0x2b2b; 0x2b2f; 0x2b2f; 0x2b2b; 0x2a10; 0x2a10;
    0x2a2b; 0x2b2b; 0x2b2b; 0x2b2b; 0x2b2b; 0x2b31; 0x3001; 0x3337;
    0x1615; 0x1407; 0x0711; 0x2335; 0x2315; 0x2311; 0x0607; 0x2700;
    0x1337; 0x2127; 0x2137; 0x1617; 0x0721; 0x0207; 0x1617; 0x1133;
    0x1125; 0x0607; 0x2712; 0x1316; 0x1514; 0x0706; 0x0721; 0x3613;
    0x1615; 0x1407; 0x0607; 0x3337; 0x1617; 0x0721; 0x1133; 0x3716;
    0x1707; 0x2111; 0x3337; 0x1617; 0x0721; 0x1133; 0x3716; 0x1707;
    0x2115; 0x2313; 0x1121; 0x1101; 0x1121; 0x1101; 0x1121; 0x1101;
    0xb0c6; 0x4c69; 0x0a29; 0x71e9; 0x7550; 0x7d29; 0x010b; 0x5a04;
    0xfed9; 0x1102; 0x2967; 0x4f34; 0x17fe; 0xc13e; 0x5c11; 0x06e9;
    0x015c; 0x555b; 0x2bf5; 0x79bf; 0x5a2f; 0x4001; 0x0e4e; 0x33bd;
    0x544a; 0x60e5; 0x604b; 0x3214; 0xfe7f; 0x9956; 0x4031; 0x14fe;
    0xb499; 0x5b3d; 0x3316; 0xfeb2; 0xe767; 0x3e38; 0x16fc; 0xc173;
    0x7301; 0x1efe; 0xe201; 0x1efe; 0xe201; 0x1e03; 0x8f5e; 0x591b;
    0x0a07; 0x1afc; 0x9d98; 0xd903; 0x3596; 0xae1f; 0x01b7; 0x0228;
    0x1933; 0x8550; 0x4325; 0xfed6; 0xe007; 0x45fd; 0x5a02; 0xa650;
    0x8e72; 0x2101; 0x7b02; 0x4c2e; 0x2a1c; 0x0fb1; 0x9fb7; 0x010e;
    0x352e; 0x1d03; 0xad95; 0x8141; 0x4a2a; 0xfebd; 0x7b40; 0x4529;
    0xfeaa; 0x793b; 0x462c; 0xfe94; 0x8541; 0x4c2b; 0x8105; 0x20fe;
    0xbd01; 0x43fe; 0x8afe; 0xaa01; 0x56fe; 0x76fe; 0x9401; 0x6c00;
  ]


let () =
  let res = T.run glyph_data T.d_glyf in
  assert_ok "glyf" res
